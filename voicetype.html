<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Typing Tool (සිංහල/English/தமிழ்)</title>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #f9fafb;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 1rem;
        }
        .container {
            width: 100%;
            max-width: 56rem;
            background-color: #1f2937;
            border-radius: 1rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            padding: 2rem;
        }
        .header h1 { font-size: 2.25rem; font-weight: 700; color: #60a5fa; margin: 0; }
        .header p { color: #9ca3af; margin-top: 0.5rem; }
        #transcript {
            width: 100%;
            background-color: #111827;
            border: 2px solid #374151;
            border-radius: 0.75rem;
            padding: 1rem;
            color: #f9fafb;
            font-size: 1.125rem;
            transition: all 0.3s;
            box-sizing: border-box;
            margin-bottom: 1.5rem;
        }
        #transcript:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 2px #3b82f6; }
        #transcript.english-font { font-family: 'Times New Roman', Times, serif; font-size: 16px; }
        #transcript.glowing-border { border-color: #3b82f6; animation: pulse-glow 2s infinite alternate; }
        @keyframes pulse-glow { from { box-shadow: 0 0 0 2px #3b82f6, 0 0 10px #3b82f6; } to { box-shadow: 0 0 0 3px #60a5fa, 0 0 20px #60a5fa; } }
        .controls { display: flex; flex-wrap: wrap; align-items: center; justify-content: center; gap: 1rem; }
        .btn {
            display: flex; align-items: center; justify-content: center;
            gap: 0.75rem; color: white; font-weight: 700;
            padding: 0.75rem 1.5rem; border-radius: 0.75rem;
            border: none; cursor: pointer;
            transition: transform 0.3s, background-color 0.3s;
        }
        .btn:hover:not(:disabled) { transform: scale(1.05); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn svg { width: 1.25rem; height: 1.25rem; }
        #startButton { background-color: #2563eb; } #startButton:hover:not(:disabled) { background-color: #1d4ed8; }
        #stopButton { background-color: #dc2626; } #stopButton:hover:not(:disabled) { background-color: #b91c1c; }
        #copyButton { background-color: #4b5563; } #copyButton:hover:not(:disabled) { background-color: #374151; }
        #undoButton { background-color: #ca8a04; } #undoButton:hover:not(:disabled) { background-color: #a16207; }
        #clearButton { background-color: #f59e0b; } #clearButton:hover:not(:disabled) { background-color: #d97706; }
        #langSelector {
            background-color: #16a34a;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            padding-right: 2.5rem;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23ffffff%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right .7em top 50%;
            background-size: .65em auto;
        }
        #langSelector:hover:not(:disabled) { background-color: #15803d; }
        #langSelector option { background-color: #1f2937; color: white; }
        #status { text-align: center; color: #9ca3af; height: 1.5rem; transition: opacity 0.3s; margin-top: 1.5rem; width: 100%; }
        @media (min-width: 640px) { .btn { width: auto; } }
        .pulse { animation: pulse-animation 2s infinite; }
        @keyframes pulse-animation { 0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); } 70% { box-shadow: 0 0 0 20px rgba(59, 130, 246, 0); } 100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); } }
    </style>
</head>
<body>

    <div class="container">
        <div class="header" style="text-align: center; margin-bottom: 1.5rem;">
            <h1 id="main-title">Voice Typing Tool</h1>
            <p id="subtitle"></p>
        </div>

        <textarea id="transcript" rows="10"></textarea>
        <div id="counter" style="font-size: 0.875rem; text-align: right; color: #9ca3af; margin-bottom: 1.5rem; padding-right: 0.5rem;"></div>

        <div class="controls">
            <button id="startButton" class="btn">
                <svg fill="currentColor" viewBox="0 0 384 512"><path d="M192 0C139 0 96 43 96 96V256c0 53 43 96 96 96s96-43 96-96V96c0-53-43-96-96-96zM64 216c0-21.9-16.1-39.7-36.7-41.6C12.3 172.6 0 185.6 0 200V256c0 88.4 71.6 160 160 160v32c0 17.7 14.3 32 32 32s32-14.3 32-32V416c88.4 0 160-71.6 160-160V200c0-14.4-12.3-27.4-27.3-25.6S320 194.1 320 216v40c0 35.3-28.7 64-64 64s-64-28.7-64-64V216z"/></svg>
                <span id="startButtonText"></span>
            </button>
            <button id="stopButton" class="btn" disabled>
                <svg fill="currentColor" viewBox="0 0 512 512"><path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM192 192H320V320H192V192z"/></svg>
                <span id="stopButtonText"></span>
            </button>
            <button id="copyButton" class="btn">
                <svg fill="currentColor" viewBox="0 0 448 512"><path d="M208 0H332.1c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9V336c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V48c0-26.5 21.5-48 48-48zM48 128h80v64H64V448H256V416h64v48c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V176c0-26.5 21.5-48 48-48z"/></svg>
                <span id="copyButtonText"></span>
            </button>
            <select id="langSelector" class="btn">
                <option value="si">සිංහල</option>
                <option value="en">English</option>
                <option value="ta">தமிழ்</option>
            </select>
            <button id="undoButton" class="btn" disabled>
                <svg fill="currentColor" viewBox="0 0 512 512"><path d="M125.7 160H176c17.7 0 32-14.3 32-32s-14.3-32-32-32H48c-17.7 0-32 14.3-32 32v128c0 17.7 14.3 32 32 32s32-14.3 32-32V188.3C116.5 214.6 128 245.3 128 276c0 61.2-30.1 114.2-76.3 147.4C44.3 429.1 32 444.1 32 460.3c0 16 6.8 30.8 17.3 40.5C62.3 512 80 512 96 512c27.1 0 50.8-14.5 64-36.2C192.1 427.2 256 356.3 256 276c0-95.9-58.3-178.4-140.3-212.3c-5.5-2.3-11.5-3.7-17.7-3.7H80c-17.7 0-32 14.3-32 32s14.3 32 32 32h45.7z"/></svg>
                <span id="undoButtonText"></span>
            </button>
            <button id="clearButton" class="btn" disabled>
                <svg fill="currentColor" viewBox="0 0 448 512"><path d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"/></svg>
                <span id="clearButtonText"></span>
            </button>
        </div>
        
        <div id="status" style="text-align: center; color: #9ca3af; height: 1.5rem; transition: opacity 0.3s; margin-top: 1.5rem;"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const dom = {
                subtitle: document.getElementById('subtitle'),
                startButtonText: document.getElementById('startButtonText'),
                stopButtonText: document.getElementById('stopButtonText'),
                copyButtonText: document.getElementById('copyButtonText'),
                undoButtonText: document.getElementById('undoButtonText'),
                clearButtonText: document.getElementById('clearButtonText'),
                transcriptArea: document.getElementById('transcript'),
                counter: document.getElementById('counter'),
                statusDiv: document.getElementById('status'),
                startButton: document.getElementById('startButton'),
                stopButton: document.getElementById('stopButton'),
                copyButton: document.getElementById('copyButton'),
                langSelector: document.getElementById('langSelector'),
                undoButton: document.getElementById('undoButton'),
                clearButton: document.getElementById('clearButton'),
            };

            const translations = {
                si: {
                    subtitle: 'මයික්‍රෆෝනය ඔබා කතා කිරීමෙන් සිංහලෙන්, ඉංග්‍රීසියෙන් හෝ දෙමළෙන් ටයිප් කරන්න.',
                    startButtonText: 'සවන් දීම අරඹන්න', stopButtonText: 'නවතින්න', copyButtonText: 'පිටපත් කරන්න',
                    copied: 'පිටපත් කලා!', undoButtonText: 'Undo', clearButtonText: 'මකන්න',
                    placeholder: 'ඔබ කතා කරන දේ මෙතැන සටහන් වේවි...', statusListening: 'සවන් දෙමින්...',
                    statusStopped: 'නැවතුනා. නැවත ආරම්භ කිරීමට බොත්තම ඔබන්න.',
                    statusLangSwitch: 'භාෂාව මාරුකලා.', statusNothingToCopy: 'පිටපත් කිරීමට කිසිවක් නැත.',
                    counterWords: 'වචන', counterChars: 'අකුරු'
                },
                en: {
                    subtitle: 'Press the microphone and start speaking to type in English, Sinhala, or Tamil.',
                    startButtonText: 'Start Listening', stopButtonText: 'Stop', copyButtonText: 'Copy',
                    copied: 'Copied!', undoButtonText: 'Undo', clearButtonText: 'Clear',
                    placeholder: 'What you speak will be noted here...', statusListening: 'Listening...',
                    statusStopped: 'Stopped. Press the button to start again.',
                    statusLangSwitch: 'Language switched.', statusNothingToCopy: 'Nothing to copy.',
                    counterWords: 'Words', counterChars: 'Characters'
                },
                ta: {
                    subtitle: 'மைக்ரோஃபோனை அழுத்தி ஆங்கிலம், சிங்களம் அல்லது தமிழில் தட்டச்சு செய்யத் தொடங்குங்கள்.',
                    startButtonText: 'கேட்கத் தொடங்கு', stopButtonText: 'நிறுத்து', copyButtonText: 'நகலெடு',
                    copied: 'நகலெடுக்கப்பட்டது!', undoButtonText: 'Undo', clearButtonText: 'அழி',
                    placeholder: 'நீங்கள் பேசுவது இங்கே குறிப்பிடப்படும்...', statusListening: 'கேட்கிறது...',
                    statusStopped: 'நிறுத்தப்பட்டது. மீண்டும் தொடங்க பொத்தானை அழுத்தவும்.',
                    statusLangSwitch: 'மொழி மாற்றப்பட்டது.', statusNothingToCopy: 'நகலெடுக்க எதுவும் இல்லை.',
                    counterWords: 'வார்த்தைகள்', counterChars: 'எழுத்துக்கள்'
                }
            };
            
            let currentLang = 'si';
            let recognitionLang = 'si-LK';

            function setLanguage(lang) {
                currentLang = lang;
                
                if (lang === 'si') recognitionLang = 'si-LK';
                else if (lang === 'en') recognitionLang = 'en-US';
                else if (lang === 'ta') recognitionLang = 'ta-LK';
                
                const texts = translations[lang];
                Object.keys(texts).forEach(key => {
                    const element = dom[key];
                    if (element) {
                        if (key === 'placeholder') element.placeholder = texts[key];
                        else element.textContent = texts[key];
                    }
                });
                dom.transcriptArea.classList.toggle('english-font', lang === 'en');
                dom.langSelector.value = lang;
                updateCounter();
            }

            function updateCounter() {
                const text = dom.transcriptArea.value;
                const charCount = text.length;
                const wordCount = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
                dom.counter.textContent = `${translations[currentLang].counterWords}: ${wordCount} | ${translations[currentLang].counterChars}: ${charCount}`;
            }

            const urlParams = new URLSearchParams(window.location.search);
            const langFromUrl = urlParams.get('lang');
            if (langFromUrl && translations[langFromUrl]) {
                setLanguage(langFromUrl);
            } else {
                setLanguage('si'); // Default language
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            let recognition;
            let finalTranscriptForSession = '';

            if (SpeechRecognition) {
                recognition = new SpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = true;
                
                recognition.onstart = () => { dom.statusDiv.textContent = translations[currentLang].statusListening; dom.startButton.classList.add('pulse'); dom.transcriptArea.classList.add('glowing-border'); dom.startButton.disabled = true; dom.stopButton.disabled = false; };
                recognition.onend = () => { dom.statusDiv.textContent = translations[currentLang].statusStopped; dom.startButton.classList.remove('pulse'); dom.transcriptArea.classList.remove('glowing-border'); dom.startButton.disabled = false; dom.stopButton.disabled = true; finalTranscriptForSession = dom.transcriptArea.value; };
                recognition.onerror = (event) => { dom.statusDiv.textContent = 'Error: ' + event.error; };
                recognition.onresult = (event) => {
                    let interimTranscript = '';
                    for (let i = event.resultIndex; i < event.results.length; ++i) {
                        if (event.results[i].isFinal) {
                            finalTranscriptForSession += event.results[i][0].transcript;
                        } else {
                            interimTranscript += event.results[i][0].transcript;
                        }
                    }
                    dom.transcriptArea.value = finalTranscriptForSession + interimTranscript;
                    dom.transcriptArea.dispatchEvent(new Event('input'));
                };

                dom.startButton.addEventListener('click', () => { if (recognition) { finalTranscriptForSession = dom.transcriptArea.value; if (finalTranscriptForSession.length > 0 && !finalTranscriptForSession.endsWith(' ')) { finalTranscriptForSession += ' '; } try { recognition.lang = recognitionLang; recognition.start(); } catch(e) {} } });
                dom.stopButton.addEventListener('click', () => { if (recognition) recognition.stop(); });
                
                dom.langSelector.addEventListener('change', (event) => {
                    const newLang = event.target.value;
                    setLanguage(newLang);
                    dom.statusDiv.textContent = translations[newLang].statusLangSwitch;
                });

                dom.undoButton.addEventListener('click', () => { const currentText = dom.transcriptArea.value; if (currentText.length > 0) { const newText = currentText.slice(0, -1); dom.transcriptArea.value = newText; finalTranscriptForSession = newText; } dom.transcriptArea.dispatchEvent(new Event('input')); });
                dom.clearButton.addEventListener('click', () => { dom.transcriptArea.value = ''; finalTranscriptForSession = ''; dom.transcriptArea.dispatchEvent(new Event('input')); });
                dom.transcriptArea.addEventListener('input', () => { const isEmpty = dom.transcriptArea.value.length === 0; dom.undoButton.disabled = isEmpty; dom.clearButton.disabled = isEmpty; updateCounter(); });
                dom.copyButton.addEventListener('click', () => { if (dom.transcriptArea.value) { navigator.clipboard.writeText(dom.transcriptArea.value).then(() => { dom.copyButtonText.textContent = translations[currentLang].copied; setTimeout(() => { dom.copyButtonText.textContent = translations[currentLang].copyButtonText; }, 2000); }); } else { dom.statusDiv.textContent = translations[currentLang].statusNothingToCopy; setTimeout(() => { dom.statusDiv.textContent = ""; }, 2000); } });
            
            } else {
                dom.statusDiv.textContent = "Sorry, your browser does not support voice recognition.";
            }
        });
    </script>
</body>
</html>

